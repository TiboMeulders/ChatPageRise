@page "/homepage"
@using Rise.Client.Components
@using Rise.Client.Services
@inject NavigationManager Navigation
@inject PageTitleService PageTitleService

<PageTitle>Homepage</PageTitle>

@* AUTHENTICATIE VEREISTE UITGESCHAKELD VOOR HOMEPAGE ONTWIKKELING *@
@* Uncomment de AuthorizeView hieronder wanneer je weer login wilt vereisen *@
@* Deze sectie staat in commentaar omdat ik (Tom) bezig was met het maken van deze pagina.*@

@* <AuthorizeView>
    <Authorized> *@
        <div class="p-4 pb-24">
            
            <!-- Vriendschapsverzoeken Sectie -->
            <div class="mb-8">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold text-gray-800">Vriendschapsverzoeken</h2>
                    @if (_friendshipRequests.Count > 3) {
                        <button class="text-orange-500 hover:text-orange-600 font-semibold flex items-center text-sm"
                                @onclick='() => Navigation.NavigateTo("/friend-requests")'>
                            Alle verzoeken
                            <img src="/icons/next.svg" alt="Next" class="w-5 h-5 ml-1">
                        </button>
                    }
                </div>
                
                @if (_friendshipRequests.Any()) {
                    <div class="grid grid-cols-3 gap-4">
                        @foreach (var request in _friendshipRequests.Take(3)) {
                            <div class="bg-white rounded-lg p-3 shadow-sm border text-center cursor-pointer hover:shadow-md transition-shadow"
                                 @onclick="() => ShowFriendRequestPopup(request)">
                                <ProfileAvatar FirstName="@GetFirstName(request.Name)"
                                               LastName="@GetLastName(request.Name)"
                                               Size="lg"
                                               Class="mx-auto mb-2" />
                                <h3 class="font-semibold text-sm text-gray-800">@request.Name</h3>
                                <p class="text-xs text-gray-500 mb-3">@request.Age</p>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <p class="text-gray-500 text-center py-8">Geen vriendschapsverzoeken</p>
                }
            </div>

            <!-- Vrienden Sectie -->
            <div class="mb-8">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold text-gray-800">Vrienden</h2>
                    @if (_friends.Count > 3) {
                        <button class="text-orange-500 hover:text-orange-600 font-semibold flex items-center text-sm"
                                @onclick='() => Navigation.NavigateTo("/friends")'>
                            Alle vrienden
                            <img src="/icons/next.svg" alt="Next" class="w-5 h-5 ml-1">
                        </button>
                    }
                </div>
                
                @if (_friends.Any()) {
                    <div class="grid grid-cols-3 gap-4">
                        @foreach (var friend in _friends.Take(3)) {
                            <div class="bg-white rounded-lg p-3 shadow-sm border text-center relative cursor-pointer hover:shadow-md transition-shadow"
                                 @onclick="() => NavigateToProfile(friend.Id)">
                                <!-- Online status indicator -->
                                <div class="absolute top-2 right-2">
                                    <div class="w-3 h-3 @(friend.IsOnline ? "bg-green-500" : "bg-gray-400") rounded-full"></div>
                                </div>
                                <ProfileAvatar FirstName="@GetFirstName(friend.Name)"
                                               LastName="@GetLastName(friend.Name)"
                                               Size="lg"
                                               Class="mx-auto mb-2" />
                                <h3 class="font-semibold text-sm text-gray-800">@friend.Name</h3>
                                <p class="text-xs text-gray-500">@friend.Age</p>
                            </div>
                        }
                    </div>
                }
                else {
                    <p class="text-gray-500 text-center py-8">Nog geen vrienden toegevoegd</p>
                }
            </div>

            <!-- Voorgestelde Vrienden Sectie -->
            <div class="mb-8">
                <div class="mb-4">
                    <h2 class="text-xl font-bold text-gray-800">Voorgesteld</h2>
                </div>
                
                <div class="grid grid-cols-3 gap-4">
                    @foreach (var suggestion in _suggestedFriends.Take(6)) {
                        <div class="bg-white rounded-lg p-3 shadow-sm border text-center cursor-pointer hover:shadow-md transition-shadow"
                             @onclick="() => ShowSuggestedFriendPopup(suggestion)">
                            <ProfileAvatar FirstName="@GetFirstName(suggestion.Name)"
                                           LastName="@GetLastName(suggestion.Name)"
                                           Size="lg"
                                           Class="mx-auto mb-2" />
                            <h3 class="font-semibold text-sm text-gray-800">@suggestion.Name</h3>
                            <p class="text-xs text-gray-500 mb-3">@suggestion.Age</p>
                        </div>
                    }
                </div>
                
                @if (_suggestedFriends.Count > 6) {
                    <div class="grid grid-cols-3 gap-4 mt-4">
                        @foreach (var suggestion in _suggestedFriends.Skip(6).Take(2)) {
                            <div class="bg-white rounded-lg p-3 shadow-sm border text-center cursor-pointer hover:shadow-md transition-shadow"
                                 @onclick="() => ShowSuggestedFriendPopup(suggestion)">
                                <ProfileAvatar FirstName="@GetFirstName(suggestion.Name)"
                                               LastName="@GetLastName(suggestion.Name)"
                                               Size="lg"
                                               Class="mx-auto mb-2" />
                                <h3 class="font-semibold text-sm text-gray-800">@suggestion.Name</h3>
                                <p class="text-xs text-gray-500 mb-3">@suggestion.Age</p>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>

        <!-- Popup voor vriendschapsverzoeken -->
        <FriendRequestPopup IsVisible="_showPopup" 
                           SelectedPerson="_selectedPerson" 
                           OnClose="EventCallback.Factory.Create(this, ClosePopup)"
                           OnAccept="EventCallback.Factory.Create<object>(this, AcceptFriendRequest)"
                           OnReject="EventCallback.Factory.Create<object>(this, RejectFriendRequest)" />

        <!-- Popup voor voorgestelde vrienden -->
        <FriendRequestPopup IsVisible="_showSuggestedPopup" 
                           SelectedPerson="_selectedSuggestedPerson" 
                           Title="Vriendschapsverzoek versturen"
                           Message="Wil je deze persoon een vriendschapsverzoek sturen?"
                           AcceptButtonText="Toevoegen"
                           RejectButtonText="Negeren"
                           AcceptButtonClass="bg-orange-500"
                           AcceptButtonHoverClass="hover:bg-orange-600"
                           AcceptButtonRingClass="focus:ring-orange-400"
                           OnClose="EventCallback.Factory.Create(this, CloseSuggestedPopup)"
                           OnAccept="EventCallback.Factory.Create<object>(this, AddSuggestedFriend)"
                           OnReject="EventCallback.Factory.Create<object>(this, RejectSuggestedFriend)" />

@*     </Authorized>
    <NotAuthorized>
        <Rise.Client.Identity.RedirectToLogin />
    </NotAuthorized>
</AuthorizeView> *@
